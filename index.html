<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Circonscriptions électorales</title>
    <style>
    </style>
</head>
<body>
<script src="//d3js.org/d3.v4.min.js" charset="utf-8"></script>
<script src="//d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="//d3js.org/topojson.v3.js"></script>

<select></select><br>
<script>
  const select = d3.select("select");

  const width = 960, height = 1160;
  const svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

  const choices = ['MÉLENCHON', 'MACRON', 'LE PEN', 'FILLON', 'rang'];


  select.selectAll('option').data(choices)
    .enter()
    .append('option')
    .attr('value', function(d) { return d;})
    .text(function(d) { return d;});

  const colors = {
    'MÉLENCHON': d3.scaleSequential(d3.interpolateReds).domain([0, 0.5]),
    'MACRON': d3.scaleSequential(d3.interpolateOranges).domain([0, 0.5]),
    'LE PEN': d3.scaleSequential(d3.interpolateGreys).domain([0, 0.5]),
    'FILLON': d3.scaleSequential(d3.interpolatePurples).domain([0, 0.5]),
    'rang': d3.scaleSequential(d3.interpolateReds).domain([5, 1])
  };

  const projection = d3.geoAlbers()
    .center([0, 46])
    .rotate([-2, 0])
    .parallels([40, 50])
    .scale(6000)
    .translate([width / 2, height / 2]);

  const path = d3.geoPath()
    .projection(projection);

  function draw(data, choice) {
    const t = d3.transition().duration(750);

    const circos = svg.selectAll('.circos').data(data, function(d) { return d.properties.ID; });
    // Enter
    circos.enter().append('path')
      .attr('class', 'circos')
      .attr('d', path)
      // UPDATE
      .merge(circos)
      .transition(t)
      .attr('fill', function (d) {
        return colors[choice](d.properties.votes[choice]);
      });
  }

  d3.json("data/circos_exprimes.json", function (error, topology) {
    console.log(topology);
    if (error) return console.error(error);

    window.topology = topology;

    const features = topojson.feature(topology, topology.objects.circos).features;

    draw(features, 'MÉLENCHON');

    select.on('change', function() {
      draw(features, select.node().value);
    })
  })
</script>
</body>
</html>

